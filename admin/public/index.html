<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Caddy 管理后台</title>
</head>
<body>
<h1>Caddy 管理后台</h1>

<form id="f">
路径 <input id="p"> → 目标 <input id="t">
<button>添加</button>
</form>

<button onclick="reload()">一键重载</button>

<ul id="list"></ul>

<script>
async function load() {
  const r = await fetch('/admin/api/routes').then(r=>r.json());
  list.innerHTML='';
  r.forEach(i=>{
    const li=document.createElement('li');
    li.innerHTML=`${i.path} → ${i.target} [${i.status}]
      <button onclick="del('${i.path}')">删</button>`;
    list.appendChild(li);
  });
}

f.onsubmit=async e=>{
  e.preventDefault();
  alert(await fetch('/admin/api/routes',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({path:p.value,target:t.value})
  }).then(r=>r.text()));
  load();
};

async function del(p){
  await fetch('/admin/api/routes/'+encodeURIComponent(p),{method:'DELETE'});
  load();
}

async function reload(){
  alert(await fetch('/admin/api/reload',{method:'POST'}).then(r=>r.text()));
}

load();
</script>
</body>
</html>
